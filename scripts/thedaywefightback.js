/*
   _            _     __
  | |_ __ _ ___| | __/ _| ___  _ __ ___ ___
  | __/ _` / __| |/ / |_ / _ \| '__/ __/ _ \
  | || (_| \__ \   <|  _| (_) | | | (_|  __/
   \__\__,_|___/_|\_\_|  \___/|_|  \___\___|

  =============================================================================

  A generic widget include script which we will use to show further campaigns

  <thomasalwyndavis@gmail.com> or http://taskforce.is for support

  =============================================================================

  @source: https://raw.github.com/tfrce/thedaywefightback.js/gh-pages/widget.js

  @licstart  The following is the entire license notice for the
             JavaScript code in this page.

  Copyright (C) 2014 Taskforce <http://taskforce.is>

  The JavaScript code in this page is free software: you can
  redistribute it and/or modify it under the terms of the GNU Affero
  General Public License (GNU AGPL) as published by the Free Software
  Foundation, either version 3 of the License, or (at your option) any
  later version.  The code is distributed WITHOUT ANY WARRANTY;
  without even the implied warranty of MERCHANTABILITY or FITNESS FOR
  A PARTICULAR PURPOSE.  See the GNU AGPL for more details.

  As additional permission under GNU AGPL version 3 section 7, you may
  distribute non-source (e.g., minimized or compacted) forms of that
  code without the copy of the GNU AGPL normally required by section
  4, provided you include this license notice and a URL through which
  recipients can access the Corresponding Source.

 @licend  The above is the entire license notice for the JavaScript
          code in this page.

*/
var _tdwfb_config=typeof tdwfb_config!=="undefined"?tdwfb_config:{};(function(window,widgetConfig){function debug(){if(widgetConfig.debug){if(this.console){console.log.apply(console,arguments)}}}function setCookie(e,t,n){var r=new Date((new Date).getTime()+n*1e3);var i=escape(t)+(n===null?"":"; expires="+r.toUTCString());document.cookie=e+"="+i}function getCookie(e){var t=document.cookie;var n=t.indexOf(" "+e+"=");if(n===-1){n=t.indexOf(e+"=")}if(n===-1){t=null}else{n=t.indexOf("=",n)+1;var r=t.indexOf(";",n);if(r===-1){r=t.length}t=unescape(t.substring(n,r))}return t}var JSON;JSON||(JSON={});(function(){function k(e){return e<10?"0"+e:e}function o(e){p.lastIndex=0;return p.test(e)?'"'+e.replace(p,function(e){var t=r[e];return typeof t==="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function l(t,r){var s,u,a,f,c=e,h,p=r[t];p&&typeof p==="object"&&typeof p.toJSON==="function"&&(p=p.toJSON(t));typeof i==="function"&&(p=i.call(r,t,p));switch(typeof p){case"string":return o(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";e+=n;h=[];if(Object.prototype.toString.apply(p)==="[object Array]"){f=p.length;for(s=0;s<f;s+=1)h[s]=l(s,p)||"null";a=h.length===0?"[]":e?"[\n"+e+h.join(",\n"+e)+"\n"+c+"]":"["+h.join(",")+"]";e=c;return a}if(i&&typeof i==="object"){f=i.length;for(s=0;s<f;s+=1)typeof i[s]==="string"&&(u=i[s],(a=l(u,p))&&h.push(o(u)+(e?": ":":")+a))}else for(u in p)Object.prototype.hasOwnProperty.call(p,u)&&(a=l(u,p))&&h.push(o(u)+(e?": ":":")+a);a=h.length===0?"{}":e?"{\n"+e+h.join(",\n"+e)+"\n"+c+"}":"{"+h.join(",")+"}";e=c;return a}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+k(this.getUTCMonth()+1)+"-"+k(this.getUTCDate())+"T"+k(this.getUTCHours())+":"+k(this.getUTCMinutes())+":"+k(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var q=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,p=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,n,r={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;if(typeof JSON.stringify!=="function")JSON.stringify=function(t,r,s){var o;n=e="";if(typeof s==="number")for(o=0;o<s;o+=1)n+=" ";else typeof s==="string"&&(n=s);if((i=r)&&typeof r!=="function"&&(typeof r!=="object"||typeof r.length!=="number"))throw Error("JSON.stringify");return l("",{"":t})};if(typeof JSON.parse!=="function")JSON.parse=function(a,e){function c(t,n){var r,i,s=t[n];if(s&&typeof s==="object")for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i=c(s,r),i!==void 0?s[r]=i:delete s[r]);return e.call(t,n,s)}var d,a=String(a);q.lastIndex=0;q.test(a)&&(a=a.replace(q,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+a+")"),typeof e==="function"?c({"":d},""):d;throw new SyntaxError("JSON.parse")}})();widgetConfig.show_style=widgetConfig.show_style||"banner";widgetConfig.greeting=widgetConfig.greeting||"Dear Internet";widgetConfig.debug=widgetConfig.debug||false;widgetConfig.localAssets=widgetConfig.localAssets||false;widgetConfig.callOnly=widgetConfig.callOnly||false;widgetConfig.startAsMinimized=widgetConfig.startAsMinimized||false;widgetConfig.disableDate=widgetConfig.disableDate||false;widgetConfig.campaign=widgetConfig.campaign||"thedaywefightback";widgetConfig.cookieTimeout=widgetConfig.cookieTimeout||172800;widgetConfig.overrideLocation=widgetConfig.overrideLocation||false;var activeCampaign;var ASSET_URL;if(widgetConfig.localAssets){ASSET_URL="../thedaywefightback/"}else{ASSET_URL="//d1agz031tafz8n.cloudfront.net/thedaywefightback.js"+"/thedaywefightback/"}var checks={correctDate:function(e){debug("correctDate()");window.tdwfbCheckDate=function(t){debug("tdwfbCheckDate()",t);e(t)};var t=document.createElement("script");t.src="//dznh7un1y2etk.cloudfront.net/time?callback=tdwfbCheckDate";document.getElementsByTagName("head")[0].appendChild(t);window.tdwfbDateCallBackFailSafe=setTimeout(function(){if((new Date).getDate()===11){e({thedaywefightback:true})}else{e({thedaywefightback:false})}},5e3)},location:function(e){debug("location()");window.tdwfbParseLocation=function(t){debug("tdwfbParseLocation()",t);e(t)};var t=getCookie(activeCampaign.locationCookieName);if(t===null){var n=document.createElement("script");n.src="https://geoip.taskforce.is/?callback=tdwfbParseLocation";document.getElementsByTagName("head")[0].appendChild(n);window.tdwfbLocationCallBackFailSafe=setTimeout(function(){e({country:{iso_code:"US"}})},5e3)}else{e(JSON.parse(t))}}};var campaign={thedaywefightback:{cookieName:"thedaywefightback_hasseen",locationCookieName:"thedaywefightback_locationb",styles:{banner:{campaignSpacer:"height: 50px;",campaignContainer:"background: #000; position: fixed; "+"width: 100%; bottom: 0; left: 0; z-index: 100000; padding: 0; "+"-webkit-box-sizing: border-box; -moz-box-sizing: border-box;",iframeContainer:"position: relative; height: 350px; width: 100%; "+"margin: 0; background: #000; z-index: 1;",iframe:"width: 100%; height: 100%; border: 0; margin: 0; "+"padding: 0; background: #000;",footerOverlay:"cursor: pointer; position: absolute; bottom: 0; "+"height: 50px; width: 100%; margin: 0; background: none; "+"z-index: 2;",closeButton:"border: 0; height: 26px; width: 26px; "+"cursor: pointer; position: absolute; top: 20px; right: 20px; "+'background: url("'+ASSET_URL+'imgs/close-button.png") no-repeat right top;',mobileCloseButton:"border: 0; height: 20px; width: 20px; "+"cursor: pointer; position: absolute;top: 10px; right: 10px; "+'background: url("'+ASSET_URL+'imgs/close-button-mobile.png") no-repeat right top;',openButton:"border: 0; height: 26px; width: 26px; "+"cursor: pointer; position: absolute; bottom: 10px; "+'right: 20px; background: url("'+ASSET_URL+'imgs/open-button.png") no-repeat right top;'}},minimized:false,show:function(e){debug("show()",e);var t=getCookie(activeCampaign.cookieName);if(widgetConfig.startAsMinimized&&t===null){this.minimized=true}var n=activeCampaign.styles[activeCampaign.config.show_style];if(n.overlay){var r=document.createElement("div");r.style.cssText=n.overlay;document.body.appendChild(r)}if(document.getElementById("tdwfb-spacer")){document.body.removeChild(document.getElementById("tdwfb-spacer"))}if(document.getElementById("tdwfb-container")){document.body.removeChild(document.getElementById("tdwfb-container"))}var i=document.createElement("div");window.tdwfbCampaignSpacer=i;i.style.cssText=n.campaignSpacer;i.setAttribute("id","tdwfb-spacer");i.setAttribute("class","tdwfb-spacer");var s=document.createElement("div");window.tdwfbCampaignContainer=s;s.style.cssText=n.campaignContainer;s.setAttribute("id","tdwfb-container");s.setAttribute("class","tdwfb-container");var o=document.createElement("div");o.style.cssText=n.iframeContainer;var u=document.documentElement,a=document.getElementsByTagName("body")[0],f=window.innerWidth||u.clientWidth||a.clientWidth;if(f<767){if(!this.minimized){o.style.height="100px"}else{o.style.height="0px"}}else{if(this.minimized){o.style.height="50px"}else{o.style.height="350px"}var l=document.createElement("div");l.style.cssText=n.footerOverlay;s.appendChild(l)}s.appendChild(o);document.body.appendChild(i);document.body.appendChild(s);var c=e.location&&e.location.country&&e.location.country.iso_code||"unknown";var h=true;if(t!==null){h=false}if(f<767){h=false}var p=document.createElement("iframe");p.style.cssText=n.iframe;var d=p.src=ASSET_URL+activeCampaign.config.show_style+".html?firstTime="+h+"&callOnly="+widgetConfig.callOnly+"&iso="+c+"&greeting="+widgetConfig.greeting;if(c==="US"&&!widgetConfig.overrideLocation||widgetConfig.overrideLocation==="usa"){p.src=d}else if(c!=="US"&&!widgetConfig.overrideLocation||widgetConfig.overrideLocation==="international"){p.src=ASSET_URL+activeCampaign.config.show_style+"_international.html?firstTime="+h+"&iso="+c+"&greeting="+widgetConfig.greeting}o.appendChild(p);var v=this;if(f>767){v.fullSize=true;var m=document.createElement("button");m.style.cssText=n.closeButton;o.appendChild(m);var g=document.createElement("button");g.style.cssText=n.openButton;o.appendChild(g);if(this.minimized){g.style.display="block";m.style.display="none";l.style.display="block"}else{g.style.display="none";m.style.display="block";l.style.display="none"}var y=function(){if(!v.minimized){o.style.height="50px";v.minimized=true;l.style.display="block";m.style.display="none";g.style.display="block";setCookie(activeCampaign.cookieName,'{"minimized": true}',widgetConfig.cookieTimeout)}else{o.style.height="350px";v.minimized=false;l.style.display="none";g.style.display="none";m.style.display="block";setCookie(activeCampaign.cookieName,'{"minimized": false}',widgetConfig.cookieTimeout)}};l.onclick=y;m.onclick=y}else{v.fullSize=false;var b=document.createElement("button");b.style.cssText=n.mobileCloseButton;o.appendChild(b);debug(v.minimized);if(v.minimized){b.style.display="none"}else{b.style.display="block"}b.onclick=function(){setCookie(activeCampaign.cookieName,'{"minimized": true}',widgetConfig.cookieTimeout);document.body.removeChild(s)}}},init:function(e){activeCampaign.config=e;var t=getCookie(activeCampaign.cookieName);var n=this;if(t){this.minimized=JSON.parse(t).minimized}checks.correctDate(function(e){debug("correctDate() callback",e);clearTimeout(window.tdwfbDateCallBackFailSafe);if(e&&(e.thedaywefightback||widgetConfig.disableDate||widgetConfig.debug)){checks.location(function(e){debug("location() callback",e);window.tdwfbLocation=e;clearTimeout(window.tdwfbLocationCallBackFailSafe);setCookie(activeCampaign.locationCookieName,JSON.stringify(e),widgetConfig.cookieTimeout);activeCampaign.show({location:e,widgetConfig:widgetConfig});if(window.addEventListener)window.addEventListener("resize",function(){var e=window,t=document,r=t.documentElement,i=t.getElementsByTagName("body")[0],s=e.innerWidth||r.clientWidth||i.clientWidth,o=e.innerHeight||r.clientHeight||i.clientHeight;if(n.fullSize&&s<767||!n.fullSize&&s>767){if(window.tdwfbResizeCallback){clearTimeout(window.tdwfbResizeCallback)}window.tdwfbResizeCallback=setTimeout(function(){n.show({location:window.tdwfbLocation,widgetConfig:widgetConfig});windowWidth=s},50)}},false)})}})}}};if(typeof campaign[widgetConfig.campaign]!=="undefined"){activeCampaign=campaign[widgetConfig.campaign];activeCampaign.init(widgetConfig)}else{return false}})(window,_tdwfb_config)
